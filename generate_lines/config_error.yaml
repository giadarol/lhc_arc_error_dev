# =============================================================================
# Unified HL-LHC Error Line Configuration
# =============================================================================
# Magnet assignments and error switches for run_mask.py.
# Beam/optics parameters are set directly in mask_all_errors.madx.

# --- Paths ---
acc_models_lhc: null

# --- General ---
beam: 1                   # 1 or 2 (beam 2 maps to mylhcbeam=4 in MAD-X)
seed: 1                    # seed for arc errors (ignored if arcs disabled)

# --- Error switches ---
errors:
  arcs: true               # par_on_errors_LHC (MB, MQ, spool-piece correctors)
  D1: false                 # measured FQ for MBXF (D1 separation dipole)
  D2: false                 # measured FQ for MBRD (D2 separation dipole, 2-in-1)
  MCBRD: false              # random errors for MCBRD (D2 correctors)
  triplet: false            # measured FQ for MQXFA/MQXFB (Q1/Q2/Q3)


# =============================================================================
# D1 configuration (MBXF / MBXAB)
# =============================================================================
# Single-aperture separation dipole. 4 magnets, 4 positions.
# L-side -> is_inv=0 (errorgenerate_dip), R-side -> is_inv=1 (errorgenerate_dip_inv)

D1:
  fq_path: ../MBXF_data/data/FQ_MBXF
  reference_radius: 0.050   # metres (50 mm)
  measurement: cold_nominal
  positions:
    4l1: MBXF1
    4r1: MBXF2
    4l5: MBXF3
    4r5: MBXF5


# =============================================================================
# D2 configuration (MBRD)
# =============================================================================
# Double-aperture (2-in-1) separation dipole. 5 magnets available, 4 positions.
# L-side -> is_inv=1 (errorgenerate_dip_inv), R-side -> is_inv=0 (errorgenerate_dip)
# NOTE: D2 is_inv is OPPOSITE to D1.
#
# beam1_aperture: which measurement aperture (AP1 or AP2) beam 1 goes through.
#   AP1/AP2 = left/right as seen from the connection side of the magnet.
#   The mapping depends on the magnet installation orientation and may differ
#   between L-side and R-side.

D2:
  fq_path: ../MBRD_data/data/FQ_MBRD_nominal
  reference_radius: 0.035   # metres (35 mm)
  measurement: cold_nominal_extrapolation
  beam1_aperture:
    left:  AP1              # L-side positions (4l1, 4l5)
    right: AP1              # R-side positions (4r1, 4r5) — AP1 is beam 1 on both sides
  positions:
    4l1: MBRD1
    4r1: MBRD2
    4l5: MBRD3
    4r5: MBRD4
  spare: MBRD5


# =============================================================================
# Triplet configuration (MQXFA / MQXFB)
# =============================================================================
# Inner triplet: Q1 (MQXFA), Q2 (MQXFB), Q3 (MQXFA).
# Each position has two halves (a/b). Q1/Q3 use cryoassemblies, Q2 lists magnets.

triplet:
  fq_paths:
    MQXFA: ../LMQXFA_data/data/FQ_MQXFA
    MQXFB: ../LMQXFB_data/data/FQ_tables/cold_nominal
    random_model: ../LMQXFA_data/data/random_data.yaml

  reference_radius: 0.050   # metres (50 mm)
  measurement: cold_nominal

  # Cryoassembly composition: [A-magnet, B-magnet]
  cryoassemblies:
    CA01: [MQXFA04, MQXFA03]
    CA02: [MQXFA05, MQXFA06]
    CA03: [MQXFA10, MQXFA11]
    CA04: [MQXFA14b, MQXFA08b]
    CA05: [MQXFA07b, MQXFA15]
    CA06: [MQXFA18, MQXFA13b]
    CA07: [MQXFA17b, MQXFA12b]
    CA08: [MQXFA19, MQXFA20]
    CA09: [MQXFA21, MQXFA22]    # synthetic
    CA10: [MQXFA23, MQXFA24]    # synthetic

  # Position assignments
  Q1:
    prefix: mqxfa
    slice_ids: [a1, b1]
    positions:
      l5: CA03
      r1: CA05
      r5: CA08
      l1: CA06

  Q2:
    prefix: mqxfb
    slice_ids: [a2, b2]
    positions:
      l5: [MQXFB05, MQXFB04]
      r1: [MQXFB03, MQXFB06]
      r5: [MQXFB07, MQXFB08]
      l1: [MQXFB09, MQXFB10]

  Q3:
    prefix: mqxfa
    slice_ids: [a3, b3]
    positions:
      l5: CA07
      r1: CA04
      r5: CA09
      l1: CA10

  # Synthetic magnets (CA09/CA10 — no real measurements yet)
  synthetic:
    seed: 1
    magnets: [MQXFA21, MQXFA22, MQXFA23, MQXFA24]


# =============================================================================
# MCBRD configuration (D2 correctors: MCBRDH / MCBRDV)
# =============================================================================
# 2-in-1 corrector dipoles next to D2. Uses errorgenerate_abs installation.
# v1.5 cabling (beam 1): MCBRDH iap=2, MCBRDV iap=1.
# Uniform random multipole errors centered at 0 (no systematic component).
# No sign logic (assign_sign_from_optics removed).

MCBRD:
  reference_radius: 0.035    # metres (35 mm)
  bdl_ref: 2.0               # BRef integrated [T*m] (was 5.0, now 2.0)
  default_range: 3.0         # +-3 units (1e-4) for most orders
  special_range: 15.0        # +-15 units (1e-4) for b2, a2, b3, a3
  special_orders: [2, 3]     # orders that get +-15 instead of +-3
  positions: [4L1, 4R1, 4L5, 4R5]
